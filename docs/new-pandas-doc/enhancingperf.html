<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Enhancing Performance &#8212; pandas 0.24.0.dev0+98.gbd95c4b9f documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sparse data structures" href="sparse.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/pandas_logo.png"></span>
          pandas</a>
        <span class="navbar-text navbar-version pull-left"><b>0.24.0.dev0+98.gbd95c4b9f</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s New</a><ul>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-24-0">v0.24.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-23-1">v0.23.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-23-0-may-15-2018">v0.23.0 (May 15, 2018)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-22-0-december-29-2017">v0.22.0 (December 29, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-21-1-december-12-2017">v0.21.1 (December 12, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-21-0-october-27-2017">v0.21.0 (October 27, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-20-3-july-7-2017">v0.20.3 (July 7, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-20-2-june-4-2017">v0.20.2 (June 4, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-20-1-may-5-2017">v0.20.1 (May 5, 2017)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-19-2-december-24-2016">v0.19.2 (December 24, 2016)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-19-1-november-3-2016">v0.19.1 (November 3, 2016)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-19-0-october-2-2016">v0.19.0 (October 2, 2016)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-18-1-may-3-2016">v0.18.1 (May 3, 2016)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-18-0-march-13-2016">v0.18.0 (March 13, 2016)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-17-1-november-21-2015">v0.17.1 (November 21, 2015)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-17-0-october-9-2015">v0.17.0 (October 9, 2015)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-16-2-june-12-2015">v0.16.2 (June 12, 2015)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-16-1-may-11-2015">v0.16.1 (May 11, 2015)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-16-0-march-22-2015">v0.16.0 (March 22, 2015)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-15-2-december-12-2014">v0.15.2 (December 12, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-15-1-november-9-2014">v0.15.1 (November 9, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-15-0-october-18-2014">v0.15.0 (October 18, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-14-1-july-11-2014">v0.14.1 (July 11, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-14-0-may-31-2014">v0.14.0 (May 31 , 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-13-1-february-3-2014">v0.13.1 (February 3, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-13-0-january-3-2014">v0.13.0 (January 3, 2014)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-12-0-july-24-2013">v0.12.0 (July 24, 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-11-0-april-22-2013">v0.11.0 (April 22, 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-10-1-january-22-2013">v0.10.1 (January 22, 2013)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-10-0-december-17-2012">v0.10.0 (December 17, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-9-1-november-14-2012">v0.9.1 (November 14, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-9-0-october-7-2012">v0.9.0 (October 7, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-8-1-july-22-2012">v0.8.1 (July 22, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v0-8-0-june-29-2012">v0.8.0 (June 29, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-7-3-april-12-2012">v.0.7.3 (April 12, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-7-2-march-16-2012">v.0.7.2 (March 16, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-7-1-february-29-2012">v.0.7.1 (February 29, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-7-0-february-9-2012">v.0.7.0 (February 9, 2012)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-6-1-december-13-2011">v.0.6.1 (December 13, 2011)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-6-0-november-25-2011">v.0.6.0 (November 25, 2011)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-5-0-october-24-2011">v.0.5.0 (October 24, 2011)</a></li>
<li class="toctree-l2"><a class="reference internal" href="whatsnew.html#v-0-4-3-through-v0-4-1-september-25-october-9-2011">v.0.4.3 through v0.4.1 (September 25 - October 9, 2011)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#plan-for-dropping-python-2-7">Plan for dropping Python 2.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#python-version-support">Python version support</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installing-pandas">Installing pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#running-the-test-suite">Running the test suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#dependencies">Dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#where-to-start">Where to start?</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#bug-reports-and-enhancement-requests">Bug reports and enhancement requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#working-with-the-code">Working with the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#contributing-to-the-documentation">Contributing to the documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#contributing-to-the-code-base">Contributing to the code base</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html#contributing-your-changes-to-pandas">Contributing your changes to <em>pandas</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Package overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#mutability-and-copying-of-data">Mutability and copying of data</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#getting-support">Getting Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#project-governance">Project Governance</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#development-team">Development Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#institutional-partners">Institutional Partners</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="10min.html">10 Minutes to pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="10min.html#object-creation">Object Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#viewing-data">Viewing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#selection">Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#missing-data">Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#merge">Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#grouping">Grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#reshaping">Reshaping</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#time-series">Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#categoricals">Categoricals</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#plotting">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#getting-data-in-out">Getting Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="10min.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#internal-guides">Internal Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#pandas-cookbook">pandas Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#lessons-for-new-pandas-users">Lessons for new pandas users</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#practical-data-analysis-with-python">Practical data analysis with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#exercises-for-new-users">Exercises for new users</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#modern-pandas">Modern pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#excel-charts-with-pandas-vincent-and-xlsxwriter">Excel charts with pandas, vincent and xlsxwriter</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#video-tutorials">Video Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#various-tutorials">Various Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#idioms">Idioms</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#selection">Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#multiindexing">MultiIndexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#missing-data">Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#grouping">Grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#timeseries">Timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#merge">Merge</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#plotting">Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#data-in-out">Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#computation">Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#timedeltas">Timedeltas</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#aliasing-axis-names">Aliasing Axis Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#creating-example-data">Creating Example Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dsintro.html">Intro to Data Structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dsintro.html#series">Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsintro.html#dataframe">DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsintro.html#panel">Panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsintro.html#deprecate-panel">Deprecate Panel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Essential Basic Functionality</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basics.html#head-and-tail">Head and Tail</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#attributes-and-the-raw-ndarray-s">Attributes and the raw ndarray(s)</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#accelerated-operations">Accelerated operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#flexible-binary-operations">Flexible binary operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#descriptive-statistics">Descriptive statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#function-application">Function application</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#reindexing-and-altering-labels">Reindexing and altering labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#iteration">Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#dt-accessor">.dt accessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#vectorized-string-methods">Vectorized string methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#sorting">Sorting</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#copying">Copying</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#dtypes">dtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="basics.html#selecting-columns-based-on-dtype">Selecting columns based on <code class="docutils literal notranslate"><span class="pre">dtype</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="text.html">Working with Text Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="text.html#splitting-and-replacing-strings">Splitting and Replacing Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#concatenation">Concatenation</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#indexing-with-str">Indexing with <code class="docutils literal notranslate"><span class="pre">.str</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#extracting-substrings">Extracting Substrings</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#testing-for-strings-that-match-or-contain-a-pattern">Testing for Strings that Match or Contain a Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#creating-indicator-variables">Creating Indicator Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="text.html#method-summary">Method Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="options.html">Options and Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="options.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#getting-and-setting-options">Getting and Setting Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#setting-startup-options-in-python-ipython-environment">Setting Startup Options in python/ipython Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#frequently-used-options">Frequently Used Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#available-options">Available Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#number-formatting">Number Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#unicode-formatting">Unicode Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html#table-schema-display">Table Schema Display</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">Indexing and Selecting Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#different-choices-for-indexing">Different Choices for Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#attribute-access">Attribute Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#slicing-ranges">Slicing ranges</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#selection-by-label">Selection By Label</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#selection-by-position">Selection By Position</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#selection-by-callable">Selection By Callable</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#ix-indexer-is-deprecated">IX Indexer is Deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#indexing-with-list-with-missing-labels-is-deprecated">Indexing with list with missing labels is Deprecated</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#selecting-random-samples">Selecting Random Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#setting-with-enlargement">Setting With Enlargement</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#fast-scalar-value-getting-and-setting">Fast scalar value getting and setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#boolean-indexing">Boolean indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#indexing-with-isin">Indexing with isin</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#the-where-method-and-masking">The <code class="docutils literal notranslate"><span class="pre">where()</span></code> Method and Masking</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#the-query-method">The <code class="docutils literal notranslate"><span class="pre">query()</span></code> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#duplicate-data">Duplicate Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#dictionary-like-get-method">Dictionary-like <code class="docutils literal notranslate"><span class="pre">get()</span></code> method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#the-lookup-method">The <code class="docutils literal notranslate"><span class="pre">lookup()</span></code> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#index-objects">Index objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#set-reset-index">Set / Reset Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="indexing.html#returning-a-view-versus-a-copy">Returning a view versus a copy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">MultiIndex / Advanced Indexing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#hierarchical-indexing-multiindex">Hierarchical indexing (MultiIndex)</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#advanced-indexing-with-hierarchical-index">Advanced indexing with hierarchical index</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#sorting-a-multiindex">Sorting a <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#take-methods">Take Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#index-types">Index Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced.html#miscellaneous-indexing-faq">Miscellaneous indexing FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="computation.html">Computational tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="computation.html#statistical-functions">Statistical Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="computation.html#window-functions">Window Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="computation.html#aggregation">Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="computation.html#expanding-windows">Expanding Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="computation.html#exponentially-weighted-windows">Exponentially Weighted Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="missing_data.html">Working with missing data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#missing-data-basics">Missing data basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#datetimes">Datetimes</a></li>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#inserting-missing-data">Inserting missing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#calculations-with-missing-data">Calculations with missing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#cleaning-filling-missing-data">Cleaning / filling missing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="missing_data.html#missing-data-casting-rules-and-indexing">Missing data casting rules and indexing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">Group By: split-apply-combine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#splitting-an-object-into-groups">Splitting an object into groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#iterating-through-groups">Iterating through groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#selecting-a-group">Selecting a group</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#aggregation">Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#transformation">Transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#filtration">Filtration</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#dispatching-to-instance-methods">Dispatching to instance methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#flexible-apply">Flexible <code class="docutils literal notranslate"><span class="pre">apply</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#other-useful-features">Other useful features</a></li>
<li class="toctree-l2"><a class="reference internal" href="groupby.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="merging.html">Merge, join, and concatenate</a><ul>
<li class="toctree-l2"><a class="reference internal" href="merging.html#concatenating-objects">Concatenating objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="merging.html#database-style-dataframe-joining-merging">Database-style DataFrame joining/merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="merging.html#timeseries-friendly-merging">Timeseries friendly merging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reshaping.html">Reshaping and Pivot Tables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#reshaping-by-pivoting-dataframe-objects">Reshaping by pivoting DataFrame objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#reshaping-by-stacking-and-unstacking">Reshaping by stacking and unstacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#reshaping-by-melt">Reshaping by Melt</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#combining-with-stats-and-groupby">Combining with stats and GroupBy</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#pivot-tables">Pivot tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#cross-tabulations">Cross tabulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#tiling">Tiling</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#computing-indicator-dummy-variables">Computing indicator / dummy variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="reshaping.html#factorizing-values">Factorizing values</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">Time Series / Date functionality</a><ul>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#timestamps-vs-time-spans">Timestamps vs. Time Spans</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#converting-to-timestamps">Converting to Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#generating-ranges-of-timestamps">Generating Ranges of Timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#timestamp-limitations">Timestamp Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#indexing">Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#time-date-components">Time/Date Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#dateoffset-objects">DateOffset Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#time-series-related-instance-methods">Time Series-Related Instance Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#resampling">Resampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#time-span-representation">Time Span Representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#converting-between-representations">Converting Between Representations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#representing-out-of-bounds-spans">Representing Out-of-Bounds Spans</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html#time-zone-handling">Time Zone Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timedeltas.html">Time Deltas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#parsing">Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#reductions">Reductions</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#frequency-conversion">Frequency Conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#attributes">Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#timedeltaindex">TimedeltaIndex</a></li>
<li class="toctree-l2"><a class="reference internal" href="timedeltas.html#resampling">Resampling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="categorical.html">Categorical Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#object-creation">Object Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#categoricaldtype">CategoricalDtype</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#working-with-categories">Working with categories</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#sorting-and-order">Sorting and Order</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#comparisons">Comparisons</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#operations">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#data-munging">Data munging</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#getting-data-in-out">Getting Data In/Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#missing-data">Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#differences-to-r-s-factor">Differences to R’s <cite>factor</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="categorical.html#gotchas">Gotchas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#basic-plotting-plot">Basic Plotting: <code class="docutils literal notranslate"><span class="pre">plot</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#other-plots">Other Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#plotting-with-missing-data">Plotting with Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#plotting-tools">Plotting Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#plot-formatting">Plot Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#plotting-directly-with-matplotlib">Plotting directly with matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html#trellis-plotting-interface">Trellis plotting interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Styling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="style.html#Building-Styles">Building Styles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="style.html#Building-Styles-Summary">Building Styles Summary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Finer-Control:-Slicing">Finer Control: Slicing</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Finer-Control:-Display-Values">Finer Control: Display Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Builtin-Styles">Builtin Styles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="style.html#Bar-charts">Bar charts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Sharing-Styles">Sharing Styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Other-Options">Other Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="style.html#Precision">Precision</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#Captions">Captions</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#Table-Styles">Table Styles</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#Hiding-the-Index-or-Columns">Hiding the Index or Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#CSS-Classes">CSS Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#Limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="style.html#Terms">Terms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Fun-stuff">Fun stuff</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Export-to-Excel">Export to Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="style.html#Extensibility">Extensibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="style.html#Subclassing">Subclassing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="io.html">IO Tools (Text, CSV, HDF5, …)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="io.html#csv-text-files">CSV &amp; Text files</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#html">HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#excel-files">Excel files</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#clipboard">Clipboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#pickling">Pickling</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#msgpack">msgpack</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#hdf5-pytables">HDF5 (PyTables)</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#feather">Feather</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#parquet">Parquet</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#sql-queries">SQL Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#google-bigquery">Google BigQuery</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#stata-format">Stata Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#sas-formats">SAS Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#other-file-formats">Other file formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html#performance-considerations">Performance Considerations</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Enhancing Performance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cython-writing-c-extensions-for-pandas">Cython (Writing C extensions for pandas)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-numba">Using Numba</a></li>
<li class="toctree-l2"><a class="reference internal" href="#expression-evaluation-via-eval">Expression Evaluation via <code class="docutils literal notranslate"><span class="pre">eval()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">Sparse data structures</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sparse.html#sparsearray">SparseArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse.html#sparseindex-objects">SparseIndex objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse.html#sparse-dtypes">Sparse Dtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse.html#sparse-calculation">Sparse Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sparse.html#interaction-with-scipy-sparse">Interaction with scipy.sparse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gotchas.html">Frequently Asked Questions (FAQ)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#dataframe-memory-usage">DataFrame memory usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#using-if-truth-statements-with-pandas">Using If/Truth Statements with pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#nan-integer-na-values-and-na-type-promotions"><code class="docutils literal notranslate"><span class="pre">NaN</span></code>, Integer <code class="docutils literal notranslate"><span class="pre">NA</span></code> values and <code class="docutils literal notranslate"><span class="pre">NA</span></code> type promotions</a></li>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#differences-with-numpy">Differences with NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#thread-safety">Thread-safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="gotchas.html#byte-ordering-issues">Byte-Ordering Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="r_interface.html">rpy2 / R interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="r_interface.html#transferring-r-data-sets-into-python">Transferring R data sets into Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="r_interface.html#converting-dataframes-into-r-objects">Converting DataFrames into R objects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">pandas Ecosystem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#statistics-and-machine-learning">Statistics and Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#visualization">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#ecosystem-ide">IDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#domain-specific">Domain Specific</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#out-of-core">Out-of-core</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#data-validation">Data validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#extension-data-types">Extension Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="ecosystem.html#accessors">Accessors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="comparison_with_r.html">Comparison with R / R libraries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_r.html#quick-reference">Quick Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_r.html#base-r">Base R</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_r.html#plyr">plyr</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_r.html#reshape-reshape2">reshape / reshape2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="comparison_with_sql.html">Comparison with SQL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#select">SELECT</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#where">WHERE</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#group-by">GROUP BY</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#join">JOIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#union">UNION</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#pandas-equivalents-for-some-sql-analytic-and-aggregate-functions">Pandas equivalents for some SQL analytic and aggregate functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#update">UPDATE</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sql.html#delete">DELETE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="comparison_with_sas.html">Comparison with SAS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#data-input-output">Data Input / Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#data-operations">Data Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#string-processing">String Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#merging">Merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#missing-data">Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#groupby">GroupBy</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_sas.html#other-considerations">Other Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="comparison_with_stata.html">Comparison with Stata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#data-structures">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#data-input-output">Data Input / Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#data-operations">Data Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#string-processing">String Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#merging">Merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#missing-data">Missing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#groupby">GroupBy</a></li>
<li class="toctree-l2"><a class="reference internal" href="comparison_with_stata.html#other-considerations">Other Considerations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developer.html#storing-pandas-dataframe-objects-in-apache-parquet-format">Storing pandas DataFrame objects in Apache Parquet format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Internals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="internals.html#indexing">Indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html#subclassing-pandas-data-structures">Subclassing pandas Data Structures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending Pandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="extending.html#registering-custom-accessors">Registering Custom Accessors</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#extension-types">Extension Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="extending.html#subclassing-pandas-data-structures">Subclassing pandas Data Structures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-23-1">pandas 0.23.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-23-0">pandas 0.23.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-22-0">pandas 0.22.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-21-1">pandas 0.21.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-21-0">pandas 0.21.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-20-0-0-20-1">pandas 0.20.0 / 0.20.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-19-2">pandas 0.19.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-19-1">pandas 0.19.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-19-0">pandas 0.19.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-18-1">pandas 0.18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-18-0">pandas 0.18.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-17-1">pandas 0.17.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-17-0">pandas 0.17.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-16-2">pandas 0.16.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-16-1">pandas 0.16.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-16-0">pandas 0.16.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-15-2">pandas 0.15.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-15-1">pandas 0.15.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-15-0">pandas 0.15.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-14-1">pandas 0.14.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-14-0">pandas 0.14.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-13-1">pandas 0.13.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-13-0">pandas 0.13.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-12-0">pandas 0.12.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-11-0">pandas 0.11.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-10-1">pandas 0.10.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-10-0">pandas 0.10.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-9-1">pandas 0.9.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-9-0">pandas 0.9.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-8-1">pandas 0.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-8-0">pandas 0.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-7-3">pandas 0.7.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-7-2">pandas 0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-7-1">pandas 0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-7-0">pandas 0.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-6-1">pandas 0.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-6-0">pandas 0.6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-5-0">pandas 0.5.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-4-3">pandas 0.4.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-4-2">pandas 0.4.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-4-1">pandas 0.4.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-4-0">pandas 0.4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html#pandas-0-3-0">pandas 0.3.0</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Enhancing Performance</a><ul>
<li><a class="reference internal" href="#cython-writing-c-extensions-for-pandas">Cython (Writing C extensions for pandas)</a></li>
<li><a class="reference internal" href="#using-numba">Using Numba</a></li>
<li><a class="reference internal" href="#expression-evaluation-via-eval">Expression Evaluation via <code class="docutils literal notranslate"><span class="pre">eval()</span></code></a></li>
</ul>
</li>
</ul>

  <li>
    <a href="sparse.html" title="Next Chapter: Sparse data structures"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Sparse data s... &raquo;</span>
    </a>
  </li>
<div id="sourcelink">
  <a href="_sources/enhancingperf.rst.txt"
     rel="nofollow">Source</a>
</div>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="enhancing-performance">
<span id="enhancingperf"></span><h1>Enhancing Performance<a class="headerlink" href="#enhancing-performance" title="Permalink to this headline">¶</a></h1>
<p>In this part of the tutorial, we will investigate how to speed up certain
functions operating on pandas <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> using three different techniques:
Cython, Numba and <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code>. We will see a speed improvement of ~200
when we use Cython and Numba on a test function operating row-wise on the
<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>. Using <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> we will speed up a sum by an order of
~2.</p>
<div class="section" id="cython-writing-c-extensions-for-pandas">
<span id="enhancingperf-cython"></span><h2>Cython (Writing C extensions for pandas)<a class="headerlink" href="#cython-writing-c-extensions-for-pandas" title="Permalink to this headline">¶</a></h2>
<p>For many use cases writing pandas in pure Python and NumPy is sufficient. In some
computationally heavy applications however, it can be possible to achieve sizable
speed-ups by offloading work to <a class="reference external" href="http://cython.org/">cython</a>.</p>
<p>This tutorial assumes you have refactored as much as possible in Python, for example
by trying to remove for-loops and making use of NumPy vectorization. It’s always worth
optimising in Python first.</p>
<p>This tutorial walks through a “typical” process of cythonizing a slow computation.
We use an <a class="reference external" href="http://docs.cython.org/src/quickstart/cythonize.html">example from the Cython documentation</a>
but in the context of pandas. Our final cythonized solution is around 100 times
faster than the pure Python solution.</p>
<div class="section" id="pure-python">
<span id="enhancingperf-pure"></span><h3>Pure python<a class="headerlink" href="#pure-python" title="Permalink to this headline">¶</a></h3>
<p>We have a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to which we want to apply a function row-wise.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ...: </span>                   <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
<span class="gp">   ...: </span>                   <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">(</span><span class="mi">1000</span><span class="p">)),</span>
<span class="gp">   ...: </span>                   <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">})</span>
<span class="gp">   ...: </span>

<span class="gp">In [2]: </span><span class="n">df</span>
<span class="gh">Out[2]: </span><span class="go"></span>
<span class="go">            a         b    N  x</span>
<span class="go">0    0.469112 -0.218470  585  x</span>
<span class="go">1   -0.282863 -0.061645  841  x</span>
<span class="go">2   -1.509059 -0.723780  251  x</span>
<span class="go">3   -1.135632  0.551225  972  x</span>
<span class="go">4    1.212112 -0.497767  181  x</span>
<span class="go">5   -0.173215  0.837519  458  x</span>
<span class="go">6    0.119209  1.103245  159  x</span>
<span class="go">..        ...       ...  ... ..</span>
<span class="go">993  0.131892  0.290162  190  x</span>
<span class="go">994  0.342097  0.215341  931  x</span>
<span class="go">995 -1.512743  0.874737  374  x</span>
<span class="go">996  0.933753  1.120790  246  x</span>
<span class="go">997 -0.308013  0.198768  157  x</span>
<span class="go">998 -0.079915  1.757555  977  x</span>
<span class="go">999 -1.010589 -1.115680  770  x</span>

<span class="go">[1000 rows x 4 columns]</span>
</pre></div>
</div>
<p>Here’s the function in pure Python:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">   ...: </span>

<span class="gp">In [4]: </span><span class="k">def</span> <span class="nf">integrate_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="gp">   ...: </span>    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">   ...: </span>    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
<span class="gp">   ...: </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="gp">   ...: </span>        <span class="n">s</span> <span class="o">+=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
<span class="gp">   ...: </span>    <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">dx</span>
<span class="gp">   ...: </span>
</pre></div>
</div>
<p>We achieve our result by using <code class="docutils literal notranslate"><span class="pre">apply</span></code> (row-wise):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="o">%</span><span class="k">timeit</span> df.apply(lambda x: integrate_f(x[&#39;a&#39;], x[&#39;b&#39;], x[&#39;N&#39;]), axis=1)
<span class="go">10 loops, best of 3: 174 ms per loop</span>
</pre></div>
</div>
<p>But clearly this isn’t fast enough for us. Let’s take a look and see where the
time is spent during this operation (limited to the most time consuming
four calls) using the <a class="reference external" href="http://ipython.org/ipython-doc/stable/api/generated/IPython.core.magics.execution.html#IPython.core.magics.execution.ExecutionMagics.prun">prun ipython magic function</a>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="o">%</span><span class="k">prun</span> -l 4 df.apply(lambda x: integrate_f(x[&#39;a&#39;], x[&#39;b&#39;], x[&#39;N&#39;]), axis=1)
<span class="go">         671897 function calls (666876 primitive calls) in 0.381 seconds</span>

<span class="go">   Ordered by: internal time</span>
<span class="go">   List reduced from 290 to 4 due to restriction &lt;4&gt;</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">     1000    0.184    0.000    0.265    0.000 &lt;ipython-input-4-c2a74e076cf0&gt;:1(integrate_f)</span>
<span class="go">   552423    0.081    0.000    0.081    0.000 &lt;ipython-input-3-c138bdd570e3&gt;:1(f)</span>
<span class="go">     3000    0.014    0.000    0.075    0.000 base.py:2975(get_value)</span>
<span class="go">     3000    0.009    0.000    0.086    0.000 series.py:764(__getitem__)</span>
</pre></div>
</div>
<p>By far the majority of time is spend inside either <code class="docutils literal notranslate"><span class="pre">integrate_f</span></code> or <code class="docutils literal notranslate"><span class="pre">f</span></code>,
hence we’ll concentrate our efforts cythonizing these two functions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Python 2 replacing the <code class="docutils literal notranslate"><span class="pre">range</span></code> with its generator counterpart (<code class="docutils literal notranslate"><span class="pre">xrange</span></code>)
would mean the <code class="docutils literal notranslate"><span class="pre">range</span></code> line would vanish. In Python 3 <code class="docutils literal notranslate"><span class="pre">range</span></code> is already a generator.</p>
</div>
</div>
<div class="section" id="plain-cython">
<span id="enhancingperf-plain"></span><h3>Plain Cython<a class="headerlink" href="#plain-cython" title="Permalink to this headline">¶</a></h3>
<p>First we’re going to need to import the Cython magic function to ipython:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="o">%</span><span class="k">load_ext</span> Cython
</pre></div>
</div>
<p>Now, let’s simply copy our functions over to Cython as is (the suffix
is here to distinguish between function versions):</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="o">%%</span><span class="k">cython</span>
<span class="gp">   ...: </span>def f_plain(x):
<span class="gp">   ...: </span>    return x * (x - 1)
<span class="gp">   ...: </span>def integrate_f_plain(a, b, N):
<span class="gp">   ...: </span>    s = 0
<span class="gp">   ...: </span>    dx = (b - a) / N
<span class="gp">   ...: </span>    for i in range(N):
<span class="gp">   ...: </span>        s += f_plain(a + i * dx)
<span class="gp">   ...: </span>    return s * dx
<span class="gp">   ...: </span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re having trouble pasting the above into your ipython, you may need
to be using bleeding edge ipython for paste to play well with cell magics.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> df.apply(lambda x: integrate_f_plain(x[&#39;a&#39;], x[&#39;b&#39;], x[&#39;N&#39;]), axis=1)
<span class="go">10 loops, best of 3: 85.5 ms per loop</span>
</pre></div>
</div>
<p>Already this has shaved a third off, not too bad for a simple copy and paste.</p>
</div>
<div class="section" id="adding-type">
<span id="enhancingperf-type"></span><h3>Adding type<a class="headerlink" href="#adding-type" title="Permalink to this headline">¶</a></h3>
<p>We get another huge improvement simply by providing type information:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="o">%%</span><span class="k">cython</span>
<span class="gp">   ...: </span>cdef double f_typed(double x) except? -2:
<span class="gp">   ...: </span>    return x * (x - 1)
<span class="gp">   ...: </span>cpdef double integrate_f_typed(double a, double b, int N):
<span class="gp">   ...: </span>    cdef int i
<span class="gp">   ...: </span>    cdef double s, dx
<span class="gp">   ...: </span>    s = 0
<span class="gp">   ...: </span>    dx = (b - a) / N
<span class="gp">   ...: </span>    for i in range(N):
<span class="gp">   ...: </span>        s += f_typed(a + i * dx)
<span class="gp">   ...: </span>    return s * dx
<span class="gp">   ...: </span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> df.apply(lambda x: integrate_f_typed(x[&#39;a&#39;], x[&#39;b&#39;], x[&#39;N&#39;]), axis=1)
<span class="go">10 loops, best of 3: 20.3 ms per loop</span>
</pre></div>
</div>
<p>Now, we’re talking! It’s now over ten times faster than the original python
implementation, and we haven’t <em>really</em> modified the code. Let’s have another
look at what’s eating up time:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="o">%</span><span class="k">prun</span> -l 4 df.apply(lambda x: integrate_f_typed(x[&#39;a&#39;], x[&#39;b&#39;], x[&#39;N&#39;]), axis=1)
<span class="go">         119288 function calls (114268 primitive calls) in 0.098 seconds</span>

<span class="go">   Ordered by: internal time</span>
<span class="go">   List reduced from 211 to 4 due to restriction &lt;4&gt;</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">     3000    0.012    0.000    0.064    0.000 base.py:2975(get_value)</span>
<span class="go">     3000    0.007    0.000    0.074    0.000 series.py:764(__getitem__)</span>
<span class="go">        1    0.006    0.006    0.097    0.097 {pandas._libs.reduction.reduce}</span>
<span class="go">     3000    0.006    0.000    0.006    0.000 {method &#39;get_value&#39; of &#39;pandas._libs.index.IndexEngine&#39; objects}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-ndarray">
<span id="enhancingperf-ndarray"></span><h3>Using ndarray<a class="headerlink" href="#using-ndarray" title="Permalink to this headline">¶</a></h3>
<p>It’s calling series… a lot! It’s creating a Series from each row, and get-ting from both
the index and the series (three times for each row). Function calls are expensive
in Python, so maybe we could minimize these by cythonizing the apply part.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We are now passing ndarrays into the Cython function, fortunately Cython plays
very nicely with NumPy.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="o">%%</span><span class="k">cython</span>
<span class="gp">   ....: </span>cimport numpy as np
<span class="gp">   ....: </span>import numpy as np
<span class="gp">   ....: </span>cdef double f_typed(double x) except? -2:
<span class="gp">   ....: </span>    return x * (x - 1)
<span class="gp">   ....: </span>cpdef double integrate_f_typed(double a, double b, int N):
<span class="gp">   ....: </span>    cdef int i
<span class="gp">   ....: </span>    cdef double s, dx
<span class="gp">   ....: </span>    s = 0
<span class="gp">   ....: </span>    dx = (b - a) / N
<span class="gp">   ....: </span>    for i in range(N):
<span class="gp">   ....: </span>        s += f_typed(a + i * dx)
<span class="gp">   ....: </span>    return s * dx
<span class="gp">   ....: </span>cpdef np.ndarray[double] apply_integrate_f(np.ndarray col_a, np.ndarray col_b, np.ndarray col_N):
<span class="gp">   ....: </span>    assert (col_a.dtype == np.float and col_b.dtype == np.float and col_N.dtype == np.int)
<span class="gp">   ....: </span>    cdef Py_ssize_t i, n = len(col_N)
<span class="gp">   ....: </span>    assert (len(col_a) == len(col_b) == n)
<span class="gp">   ....: </span>    cdef np.ndarray[double] res = np.empty(n)
<span class="gp">   ....: </span>    for i in range(len(col_a)):
<span class="gp">   ....: </span>        res[i] = integrate_f_typed(col_a[i], col_b[i], col_N[i])
<span class="gp">   ....: </span>    return res
<span class="gp">   ....: </span>
</pre></div>
</div>
<p>The implementation is simple, it creates an array of zeros and loops over
the rows, applying our <code class="docutils literal notranslate"><span class="pre">integrate_f_typed</span></code>, and putting this in the zeros array.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You can <strong>not pass</strong> a <code class="docutils literal notranslate"><span class="pre">Series</span></code> directly as a <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> typed parameter
to a Cython function. Instead pass the actual <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> using the
<code class="docutils literal notranslate"><span class="pre">.values</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">Series</span></code>. The reason is that the Cython
definition is specific to an ndarray and not the passed <code class="docutils literal notranslate"><span class="pre">Series</span></code>.</p>
<p>So, do not do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">apply_integrate_f</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>But rather, use <code class="docutils literal notranslate"><span class="pre">.values</span></code> to get the underlying <code class="docutils literal notranslate"><span class="pre">ndarray</span></code>:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">apply_integrate_f</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Loops like this would be <em>extremely</em> slow in Python, but in Cython looping
over NumPy arrays is <em>fast</em>.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> apply_integrate_f(df[&#39;a&#39;].values, df[&#39;b&#39;].values, df[&#39;N&#39;].values)
<span class="go">1000 loops, best of 3: 1.25 ms per loop</span>
</pre></div>
</div>
<p>We’ve gotten another big improvement. Let’s check again where the time is spent:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="o">%</span><span class="k">prun</span> -l 4 apply_integrate_f(df[&#39;a&#39;].values, df[&#39;b&#39;].values, df[&#39;N&#39;].values)
<span class="go">         215 function calls in 0.002 seconds</span>

<span class="go">   Ordered by: internal time</span>
<span class="go">   List reduced from 55 to 4 due to restriction &lt;4&gt;</span>

<span class="go">   ncalls  tottime  percall  cumtime  percall filename:lineno(function)</span>
<span class="go">        1    0.002    0.002    0.002    0.002 {built-in method _cython_magic_0c92d9d7b4c737488f09983f400ac764.apply_integrate_f}</span>
<span class="go">        1    0.000    0.000    0.002    0.002 {built-in method builtins.exec}</span>
<span class="go">        3    0.000    0.000    0.000    0.000 internals.py:4137(iget)</span>
<span class="go">        9    0.000    0.000    0.000    0.000 generic.py:4374(__setattr__)</span>
</pre></div>
</div>
<p>As one might expect, the majority of the time is now spent in <code class="docutils literal notranslate"><span class="pre">apply_integrate_f</span></code>,
so if we wanted to make anymore efficiencies we must continue to concentrate our
efforts here.</p>
</div>
<div class="section" id="more-advanced-techniques">
<span id="enhancingperf-boundswrap"></span><h3>More advanced techniques<a class="headerlink" href="#more-advanced-techniques" title="Permalink to this headline">¶</a></h3>
<p>There is still hope for improvement. Here’s an example of using some more
advanced Cython techniques:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="o">%%</span><span class="k">cython</span>
<span class="gp">   ....: </span>cimport cython
<span class="gp">   ....: </span>cimport numpy as np
<span class="gp">   ....: </span>import numpy as np
<span class="gp">   ....: </span>cdef double f_typed(double x) except? -2:
<span class="gp">   ....: </span>    return x * (x - 1)
<span class="gp">   ....: </span>cpdef double integrate_f_typed(double a, double b, int N):
<span class="gp">   ....: </span>    cdef int i
<span class="gp">   ....: </span>    cdef double s, dx
<span class="gp">   ....: </span>    s = 0
<span class="gp">   ....: </span>    dx = (b - a) / N
<span class="gp">   ....: </span>    for i in range(N):
<span class="gp">   ....: </span>        s += f_typed(a + i * dx)
<span class="gp">   ....: </span>    return s * dx
<span class="gp">   ....: </span>@cython.boundscheck(False)
<span class="gp">   ....: </span>@cython.wraparound(False)
<span class="gp">   ....: </span>cpdef np.ndarray[double] apply_integrate_f_wrap(np.ndarray[double] col_a, np.ndarray[double] col_b, np.ndarray[int] col_N):
<span class="gp">   ....: </span>    cdef int i, n = len(col_N)
<span class="gp">   ....: </span>    assert len(col_a) == len(col_b) == n
<span class="gp">   ....: </span>    cdef np.ndarray[double] res = np.empty(n)
<span class="gp">   ....: </span>    for i in range(n):
<span class="gp">   ....: </span>        res[i] = integrate_f_typed(col_a[i], col_b[i], col_N[i])
<span class="gp">   ....: </span>    return res
<span class="gp">   ....: </span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> apply_integrate_f_wrap(df[&#39;a&#39;].values, df[&#39;b&#39;].values, df[&#39;N&#39;].values)
<span class="go">1000 loops, best of 3: 987 us per loop</span>
</pre></div>
</div>
<p>Even faster, with the caveat that a bug in our Cython code (an off-by-one error,
for example) might cause a segfault because memory access isn’t checked.
For more about <code class="docutils literal notranslate"><span class="pre">boundscheck</span></code> and <code class="docutils literal notranslate"><span class="pre">wraparound</span></code>, see the Cython docs on
<a class="reference external" href="http://cython.readthedocs.io/en/latest/src/reference/compilation.html?highlight=wraparound#compiler-directives">compiler directives</a>.</p>
</div>
</div>
<div class="section" id="using-numba">
<span id="enhancingperf-numba"></span><h2>Using Numba<a class="headerlink" href="#using-numba" title="Permalink to this headline">¶</a></h2>
<p>A recent alternative to statically compiling Cython code, is to use a <em>dynamic jit-compiler</em>, Numba.</p>
<p>Numba gives you the power to speed up your applications with high performance functions written directly in Python. With a few annotations, array-oriented and math-heavy Python code can be just-in-time compiled to native machine instructions, similar in performance to C, C++ and Fortran, without having to switch languages or Python interpreters.</p>
<p>Numba works by generating optimized machine code using the LLVM compiler infrastructure at import time, runtime, or statically (using the included pycc tool). Numba supports compilation of Python to run on either CPU or GPU hardware, and is designed to integrate with the Python scientific software stack.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will need to install Numba. This is easy with <code class="docutils literal notranslate"><span class="pre">conda</span></code>, by using: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">numba</span></code>, see <a class="reference internal" href="install.html#install-miniconda"><span class="std std-ref">installing using miniconda</span></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of Numba version 0.20, pandas objects cannot be passed directly to Numba-compiled functions. Instead, one must pass the NumPy array underlying the pandas object to the Numba-compiled function as demonstrated below.</p>
</div>
<div class="section" id="jit">
<h3>Jit<a class="headerlink" href="#jit" title="Permalink to this headline">¶</a></h3>
<p>We demonstrate how to use Numba to just-in-time compile our code. We simply
take the plain Python code from above and annotate with the <code class="docutils literal notranslate"><span class="pre">&#64;jit</span></code> decorator.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba</span>

<span class="nd">@numba.jit</span>
<span class="k">def</span> <span class="nf">f_plain</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="nd">@numba.jit</span>
<span class="k">def</span> <span class="nf">integrate_f_numba</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
   <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
       <span class="n">s</span> <span class="o">+=</span> <span class="n">f_plain</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">dx</span>

<span class="nd">@numba.jit</span>
<span class="k">def</span> <span class="nf">apply_integrate_f_numba</span><span class="p">(</span><span class="n">col_a</span><span class="p">,</span> <span class="n">col_b</span><span class="p">,</span> <span class="n">col_N</span><span class="p">):</span>
   <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_N</span><span class="p">)</span>
   <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
   <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_b</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
      <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate_f_numba</span><span class="p">(</span><span class="n">col_a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col_b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col_N</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
   <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">compute_numba</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="n">result</span> <span class="o">=</span> <span class="n">apply_integrate_f_numba</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;result&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we directly pass NumPy arrays to the Numba function. <code class="docutils literal notranslate"><span class="pre">compute_numba</span></code> is just a wrapper that provides a nicer interface by passing/returning pandas objects.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="o">%</span><span class="k">timeit</span> compute_numba(df)
<span class="go">1000 loops, best of 3: 798 us per loop</span>
</pre></div>
</div>
<p>In this example, using Numba was faster than Cython.</p>
</div>
<div class="section" id="vectorize">
<h3>Vectorize<a class="headerlink" href="#vectorize" title="Permalink to this headline">¶</a></h3>
<p>Numba can also be used to write vectorized functions that do not require the user to explicitly
loop over the observations of a vector; a vectorized function will be applied to each row automatically.
Consider the following toy example of doubling each observation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numba</span>

<span class="k">def</span> <span class="nf">double_every_value_nonumba</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>

<span class="nd">@numba.vectorize</span>
<span class="k">def</span> <span class="nf">double_every_value_withnumba</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>


<span class="c1"># Custom function without numba</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col1_doubled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">double_every_value_nonumba</span><span class="p">)</span>
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">797</span> <span class="n">us</span> <span class="n">per</span> <span class="n">loop</span>

<span class="c1"># Standard implementation (faster than a custom function)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col1_doubled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span>
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">233</span> <span class="n">us</span> <span class="n">per</span> <span class="n">loop</span>

<span class="c1"># Custom function with numba</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;col1_doubled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">double_every_value_withnumba</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">145</span> <span class="n">us</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
</div>
</div>
<div class="section" id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Numba will execute on any function, but can only accelerate certain classes of functions.</p>
</div>
<p>Numba is best at accelerating functions that apply numerical functions to NumPy
arrays. When passed a function that only uses operations it knows how to
accelerate, it will execute in <code class="docutils literal notranslate"><span class="pre">nopython</span></code> mode.</p>
<p>If Numba is passed a function that includes something it doesn’t know how to
work with – a category that currently includes sets, lists, dictionaries, or
string functions – it will revert to <code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">mode</span></code>. In <code class="docutils literal notranslate"><span class="pre">object</span> <span class="pre">mode</span></code>,
Numba will execute but your code will not speed up significantly. If you would
prefer that Numba throw an error if it cannot compile a function in a way that
speeds up your code, pass Numba the argument
<code class="docutils literal notranslate"><span class="pre">nopython=True</span></code> (e.g.  <code class="docutils literal notranslate"><span class="pre">&#64;numba.jit(nopython=True)</span></code>). For more on
troubleshooting Numba modes, see the <a class="reference external" href="http://numba.pydata.org/numba-doc/latest/user/troubleshoot.html#the-compiled-code-is-too-slow">Numba troubleshooting page</a>.</p>
<p>Read more in the <a class="reference external" href="http://numba.pydata.org/">Numba docs</a>.</p>
</div>
</div>
<div class="section" id="expression-evaluation-via-eval">
<span id="enhancingperf-eval"></span><h2>Expression Evaluation via <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code><a class="headerlink" href="#expression-evaluation-via-eval" title="Permalink to this headline">¶</a></h2>
<p>The top-level function <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> implements expression evaluation of
<code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To benefit from using <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> you need to
install <code class="docutils literal notranslate"><span class="pre">numexpr</span></code>. See the <a class="reference internal" href="install.html#install-recommended-dependencies"><span class="std std-ref">recommended dependencies section</span></a> for more details.</p>
</div>
<p>The point of using <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> for expression evaluation rather than
plain Python is two-fold: 1) large <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> objects are
evaluated more efficiently and 2) large arithmetic and boolean expressions are
evaluated all at once by the underlying engine (by default <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> is used
for evaluation).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should not use <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> for simple
expressions or for expressions involving small DataFrames. In fact,
<code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> is many orders of magnitude slower for
smaller expressions/objects than plain ol’ Python. A good rule of thumb is
to only use <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> when you have a
<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> with more than 10,000 rows.</p>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> supports all arithmetic expressions supported by the
engine in addition to some extensions available only in pandas.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The larger the frame and the larger the expression the more speedup you will
see from using <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code>.</p>
</div>
<div class="section" id="supported-syntax">
<h3>Supported Syntax<a class="headerlink" href="#supported-syntax" title="Permalink to this headline">¶</a></h3>
<p>These operations are supported by <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code>:</p>
<ul class="simple">
<li>Arithmetic operations except for the left shift (<code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>) and right shift
(<code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>) operators, e.g., <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">+</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">pi</span> <span class="pre">/</span> <span class="pre">s</span> <span class="pre">**</span> <span class="pre">4</span> <span class="pre">%</span> <span class="pre">42</span> <span class="pre">-</span> <span class="pre">the_golden_ratio</span></code></li>
<li>Comparison operations, including chained comparisons, e.g., <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">&lt;</span> <span class="pre">df</span> <span class="pre">&lt;</span> <span class="pre">df2</span></code></li>
<li>Boolean operations, e.g., <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">&lt;</span> <span class="pre">df2</span> <span class="pre">and</span> <span class="pre">df3</span> <span class="pre">&lt;</span> <span class="pre">df4</span> <span class="pre">or</span> <span class="pre">not</span> <span class="pre">df_bool</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">list</span></code> and <code class="docutils literal notranslate"><span class="pre">tuple</span></code> literals, e.g., <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> or <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">2)</span></code></li>
<li>Attribute access, e.g., <code class="docutils literal notranslate"><span class="pre">df.a</span></code></li>
<li>Subscript expressions, e.g., <code class="docutils literal notranslate"><span class="pre">df[0]</span></code></li>
<li>Simple variable evaluation, e.g., <code class="docutils literal notranslate"><span class="pre">pd.eval('df')</span></code> (this is not very useful)</li>
<li>Math functions: <cite>sin</cite>, <cite>cos</cite>, <cite>exp</cite>, <cite>log</cite>, <cite>expm1</cite>, <cite>log1p</cite>,
<cite>sqrt</cite>, <cite>sinh</cite>, <cite>cosh</cite>, <cite>tanh</cite>, <cite>arcsin</cite>, <cite>arccos</cite>, <cite>arctan</cite>, <cite>arccosh</cite>,
<cite>arcsinh</cite>, <cite>arctanh</cite>, <cite>abs</cite> and <cite>arctan2</cite>.</li>
</ul>
<p>This Python syntax is <strong>not</strong> allowed:</p>
<ul class="simple">
<li>Expressions<ul>
<li>Function calls other than math functions.</li>
<li><code class="docutils literal notranslate"><span class="pre">is</span></code>/<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code> operations</li>
<li><code class="docutils literal notranslate"><span class="pre">if</span></code> expressions</li>
<li><code class="docutils literal notranslate"><span class="pre">lambda</span></code> expressions</li>
<li><code class="docutils literal notranslate"><span class="pre">list</span></code>/<code class="docutils literal notranslate"><span class="pre">set</span></code>/<code class="docutils literal notranslate"><span class="pre">dict</span></code> comprehensions</li>
<li>Literal <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">set</span></code> expressions</li>
<li><code class="docutils literal notranslate"><span class="pre">yield</span></code> expressions</li>
<li>Generator expressions</li>
<li>Boolean expressions consisting of only scalar values</li>
</ul>
</li>
<li>Statements<ul>
<li>Neither <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html">simple</a>
nor <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html">compound</a>
statements are allowed. This includes things like <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, and
<code class="docutils literal notranslate"><span class="pre">if</span></code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="eval-examples">
<h3><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> Examples<a class="headerlink" href="#eval-examples" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> works well with expressions containing large arrays.</p>
<p>First let’s create a few decent-sized arrays to play with:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">100</span>

<span class="gp">In [14]: </span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">df3</span><span class="p">,</span> <span class="n">df4</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
</pre></div>
</div>
<p>Now let’s compare adding them together using plain ol’ Python versus
<code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="o">%</span><span class="k">timeit</span> df1 + df2 + df3 + df4
<span class="go">18.3 ms +- 2.67 ms per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [16]: </span><span class="o">%</span><span class="k">timeit</span> pd.eval(&#39;df1 + df2 + df3 + df4&#39;)
<span class="go">9.45 ms +- 233 us per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<p>Now let’s do the same thing but with comparisons:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="o">%</span><span class="k">timeit</span> (df1 &gt; 0) &amp; (df2 &gt; 0) &amp; (df3 &gt; 0) &amp; (df4 &gt; 0)
<span class="go">25.8 ms +- 1.8 ms per loop (mean +- std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="o">%</span><span class="k">timeit</span> pd.eval(&#39;(df1 &gt; 0) &amp; (df2 &gt; 0) &amp; (df3 &gt; 0) &amp; (df4 &gt; 0)&#39;)
<span class="go">13.5 ms +- 146 us per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> also works with unaligned pandas objects:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="gp">In [20]: </span><span class="o">%</span><span class="k">timeit</span> df1 + df2 + df3 + df4 + s
<span class="go">25 ms +- 2.89 ms per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="o">%</span><span class="k">timeit</span> pd.eval(&#39;df1 + df2 + df3 + df4 + s&#39;)
<span class="go">11.5 ms +- 2.3 ms per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Operations such as</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span>  <span class="c1"># would parse to 1 &amp; 2, but should evaluate to 2</span>
<span class="mi">3</span> <span class="ow">or</span> <span class="mi">4</span>  <span class="c1"># would parse to 3 | 4, but should evaluate to 3</span>
<span class="o">~</span><span class="mi">1</span>  <span class="c1"># this is okay, but slower when using eval</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">should be performed in Python. An exception will be raised if you try to
perform any boolean/bitwise operations with scalar operands that are not
of type <code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">np.bool_</span></code>. Again, you should perform these kinds of
operations in plain Python.</p>
</div>
</div>
<div class="section" id="the-dataframe-eval-method">
<h3>The <code class="docutils literal notranslate"><span class="pre">DataFrame.eval</span></code> method<a class="headerlink" href="#the-dataframe-eval-method" title="Permalink to this headline">¶</a></h3>
<p>In addition to the top level <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> function you can also
evaluate an expression in the “context” of a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [22]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>

<span class="gp">In [23]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;a + b&#39;</span><span class="p">)</span>
<span class="gh">Out[23]: </span><span class="go"></span>
<span class="go">0   -0.246747</span>
<span class="go">1    0.867786</span>
<span class="go">2   -1.626063</span>
<span class="go">3   -1.134978</span>
<span class="go">4   -1.027798</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>Any expression that is a valid <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> expression is also a valid
<code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.eval()</span></code> expression, with the added benefit that you don’t have to
prefix the name of the <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> to the column(s) you’re
interested in evaluating.</p>
<p>In addition, you can perform assignment of columns within an expression.
This allows for <em>formulaic evaluation</em>.  The assignment target can be a
new column name or an existing column name, and it must be a valid Python
identifier.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.18.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">inplace</span></code> keyword determines whether this assignment will performed
on the original <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> or return a copy with the new column.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For backwards compatibility, <code class="docutils literal notranslate"><span class="pre">inplace</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code> if not
specified. This will change in a future version of pandas - if your
code depends on an inplace assignment you should update to explicitly
set <code class="docutils literal notranslate"><span class="pre">inplace=True</span></code>.</p>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [24]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>

<span class="gp">In [25]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;c = a + b&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">In [26]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;d = a + b + c&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">In [27]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;a = 1&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">In [28]: </span><span class="n">df</span>
<span class="gh">Out[28]: </span><span class="go"></span>
<span class="go">   a  b   c   d</span>
<span class="go">0  1  5   5  10</span>
<span class="go">1  1  6   7  14</span>
<span class="go">2  1  7   9  18</span>
<span class="go">3  1  8  11  22</span>
<span class="go">4  1  9  13  26</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">inplace</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, a copy of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with the
new or modified columns is returned and the original frame is unchanged.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [29]: </span><span class="n">df</span>
<span class="gh">Out[29]: </span><span class="go"></span>
<span class="go">   a  b   c   d</span>
<span class="go">0  1  5   5  10</span>
<span class="go">1  1  6   7  14</span>
<span class="go">2  1  7   9  18</span>
<span class="go">3  1  8  11  22</span>
<span class="go">4  1  9  13  26</span>

<span class="gp">In [30]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;e = a - c&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">                                                                                                          Out[30]: </span>
<span class="go">   a  b   c   d   e</span>
<span class="go">0  1  5   5  10  -4</span>
<span class="go">1  1  6   7  14  -6</span>
<span class="go">2  1  7   9  18  -8</span>
<span class="go">3  1  8  11  22 -10</span>
<span class="go">4  1  9  13  26 -12</span>

<span class="gp">In [31]: </span><span class="n">df</span>
<span class="go">                                                                                                                                                                                                                                            Out[31]: </span>
<span class="go">   a  b   c   d</span>
<span class="go">0  1  5   5  10</span>
<span class="go">1  1  6   7  14</span>
<span class="go">2  1  7   9  18</span>
<span class="go">3  1  8  11  22</span>
<span class="go">4  1  9  13  26</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.18.0.</span></p>
</div>
<p>As a convenience, multiple assignments can be performed by using a
multi-line string.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [32]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="gp">   ....: </span><span class="s2">c = a + b</span>
<span class="gp">   ....: </span><span class="s2">d = a + b + c</span>
<span class="gp">   ....: </span><span class="s2">a = 1&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">   ....: </span>
<span class="gh">Out[32]: </span><span class="go"></span>
<span class="go">   a  b   c   d</span>
<span class="go">0  1  5   6  12</span>
<span class="go">1  1  6   7  14</span>
<span class="go">2  1  7   8  16</span>
<span class="go">3  1  8   9  18</span>
<span class="go">4  1  9  10  20</span>
</pre></div>
</div>
<p>The equivalent in standard Python would be</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>

<span class="gp">In [34]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span>

<span class="gp">In [35]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">c</span>

<span class="gp">In [36]: </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="gp">In [37]: </span><span class="n">df</span>
<span class="gh">Out[37]: </span><span class="go"></span>
<span class="go">   a  b   c   d</span>
<span class="go">0  1  5   5  10</span>
<span class="go">1  1  6   7  14</span>
<span class="go">2  1  7   9  18</span>
<span class="go">3  1  8  11  22</span>
<span class="go">4  1  9  13  26</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.18.0.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">query</span></code> method gained the <code class="docutils literal notranslate"><span class="pre">inplace</span></code> keyword which determines
whether the query modifies the original frame.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [38]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">b</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>

<span class="gp">In [39]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &gt; 2&#39;</span><span class="p">)</span>
<span class="gh">Out[39]: </span><span class="go"></span>
<span class="go">   a  b</span>
<span class="go">3  3  8</span>
<span class="go">4  4  9</span>

<span class="gp">In [40]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;a &gt; 2&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="gp">In [41]: </span><span class="n">df</span>
<span class="gh">Out[41]: </span><span class="go"></span>
<span class="go">   a  b</span>
<span class="go">3  3  8</span>
<span class="go">4  4  9</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike with <code class="docutils literal notranslate"><span class="pre">eval</span></code>, the default value for <code class="docutils literal notranslate"><span class="pre">inplace</span></code> for <code class="docutils literal notranslate"><span class="pre">query</span></code>
is <code class="docutils literal notranslate"><span class="pre">False</span></code>.  This is consistent with prior versions of pandas.</p>
</div>
</div>
<div class="section" id="local-variables">
<h3>Local Variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h3>
<p>You must <em>explicitly reference</em> any local variable that you want to use in an
expression by placing the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character in front of the name. For example,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [42]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">))</span>

<span class="gp">In [43]: </span><span class="n">newcol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

<span class="gp">In [44]: </span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;b + @newcol&#39;</span><span class="p">)</span>
<span class="gh">Out[44]: </span><span class="go"></span>
<span class="go">0   -0.173926</span>
<span class="go">1    2.493083</span>
<span class="go">2   -0.881831</span>
<span class="go">3   -0.691045</span>
<span class="go">4    1.334703</span>
<span class="go">dtype: float64</span>

<span class="gp">In [45]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;b &lt; @newcol&#39;</span><span class="p">)</span>
<span class="go">                                                                                               Out[45]: </span>
<span class="go">          a         b</span>
<span class="go">0  0.863987 -0.115998</span>
<span class="go">2 -2.621419 -1.297879</span>
</pre></div>
</div>
<p>If you don’t prefix the local variable with <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>, pandas will raise an
exception telling you the variable is undefined.</p>
<p>When using <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.eval()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.query()</span></code>, this allows you
to have a local variable and a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> column with the same
name in an expression.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [46]: </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>

<span class="gp">In [47]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;@a &lt; a&#39;</span><span class="p">)</span>
<span class="gh">Out[47]: </span><span class="go"></span>
<span class="go">          a         b</span>
<span class="go">0  0.863987 -0.115998</span>

<span class="gp">In [48]: </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">a</span><span class="p">]</span>  <span class="c1"># same as the previous expression</span>
<span class="go">                                                      Out[48]: </span>
<span class="go">          a         b</span>
<span class="go">0  0.863987 -0.115998</span>
</pre></div>
</div>
<p>With <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> you cannot use the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> prefix <em>at all</em>, because it
isn’t defined in that context. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> will let you know this if you try to
use <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> in a top-level call to <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code>. For example,</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [49]: </span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

<span class="gp">In [50]: </span><span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;@a + b&#39;</span><span class="p">)</span>
<span class="go">Traceback (most recent call last):</span>

<span class="go">  File &quot;/home/mgarcia/.miniconda3/envs/pandas-dev/lib/python3.6/site-packages/IPython/core/interactiveshell.py&quot;, line 2963, in run_code</span>
<span class="go">    exec(code_obj, self.user_global_ns, self.user_ns)</span>

<span class="go">  File &quot;&lt;ipython-input-50-af17947a194f&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="go">    pd.eval(&#39;@a + b&#39;)</span>

<span class="go">  File &quot;/home/mgarcia/src/forks/pandas/pandas/core/computation/eval.py&quot;, line 283, in eval</span>
<span class="go">    _check_for_locals(expr, level, parser)</span>

<span class="go">  File &quot;/home/mgarcia/src/forks/pandas/pandas/core/computation/eval.py&quot;, line 150, in _check_for_locals</span>
<span class="go">    raise SyntaxError(msg)</span>

<span class="go">  File &quot;&lt;string&gt;&quot;, line unknown</span>
<span class="go">SyntaxError: The &#39;@&#39; prefix is not allowed in top-level eval calls, </span>
<span class="go">please refer to your variables by name without the &#39;@&#39; prefix</span>
</pre></div>
</div>
<p>In this case, you should simply refer to the variables like you would in
standard Python.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [51]: </span><span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;a + b&#39;</span><span class="p">)</span>
<span class="gh">Out[51]: </span><span class="go">3</span>
</pre></div>
</div>
</div>
<div class="section" id="pandas-eval-parsers">
<h3><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> Parsers<a class="headerlink" href="#pandas-eval-parsers" title="Permalink to this headline">¶</a></h3>
<p>There are two different parsers and two different engines you can use as
the backend.</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">'pandas'</span></code> parser allows a more intuitive syntax for expressing
query-like operations (comparisons, conjunctions and disjunctions). In
particular, the precedence of the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">|</span></code> operators is made equal to
the precedence of the corresponding boolean operations <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code>.</p>
<p>For example, the above conjunction can be written without parentheses.
Alternatively, you can use the <code class="docutils literal notranslate"><span class="pre">'python'</span></code> parser to enforce strict Python
semantics.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [52]: </span><span class="n">expr</span> <span class="o">=</span> <span class="s1">&#39;(df1 &gt; 0) &amp; (df2 &gt; 0) &amp; (df3 &gt; 0) &amp; (df4 &gt; 0)&#39;</span>

<span class="gp">In [53]: </span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>

<span class="gp">In [54]: </span><span class="n">expr_no_parens</span> <span class="o">=</span> <span class="s1">&#39;df1 &gt; 0 &amp; df2 &gt; 0 &amp; df3 &gt; 0 &amp; df4 &gt; 0&#39;</span>

<span class="gp">In [55]: </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">expr_no_parens</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">)</span>

<span class="gp">In [56]: </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span>
<span class="gh">Out[56]: </span><span class="go">True</span>
</pre></div>
</div>
<p>The same expression can be “anded” together with the word <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#and" title="(in Python v3.6)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">and</span></code></a> as
well:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [57]: </span><span class="n">expr</span> <span class="o">=</span> <span class="s1">&#39;(df1 &gt; 0) &amp; (df2 &gt; 0) &amp; (df3 &gt; 0) &amp; (df4 &gt; 0)&#39;</span>

<span class="gp">In [58]: </span><span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>

<span class="gp">In [59]: </span><span class="n">expr_with_ands</span> <span class="o">=</span> <span class="s1">&#39;df1 &gt; 0 and df2 &gt; 0 and df3 &gt; 0 and df4 &gt; 0&#39;</span>

<span class="gp">In [60]: </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">expr_with_ands</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">)</span>

<span class="gp">In [61]: </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span>
<span class="gh">Out[61]: </span><span class="go">True</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code> operators here have the same precedence that they would
in vanilla Python.</p>
</div>
<div class="section" id="pandas-eval-backends">
<h3><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> Backends<a class="headerlink" href="#pandas-eval-backends" title="Permalink to this headline">¶</a></h3>
<p>There’s also the option to make <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> operate identical to plain
ol’ Python.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the <code class="docutils literal notranslate"><span class="pre">'python'</span></code> engine is generally <em>not</em> useful, except for testing
other evaluation engines against it. You will achieve <strong>no</strong> performance
benefits using <code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> with <code class="docutils literal notranslate"><span class="pre">engine='python'</span></code> and in fact may
incur a performance hit.</p>
</div>
<p>You can see this by using <code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> with the <code class="docutils literal notranslate"><span class="pre">'python'</span></code> engine. It
is a bit slower (not by much) than evaluating the same expression in Python</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [62]: </span><span class="o">%</span><span class="k">timeit</span> df1 + df2 + df3 + df4
<span class="go">10.7 ms +- 44.8 us per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [63]: </span><span class="o">%</span><span class="k">timeit</span> pd.eval(&#39;df1 + df2 + df3 + df4&#39;, engine=&#39;python&#39;)
<span class="go">11.7 ms +- 249 us per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
</div>
<div class="section" id="pandas-eval-performance">
<h3><code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> Performance<a class="headerlink" href="#pandas-eval-performance" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">eval()</span></code> is intended to speed up certain kinds of operations. In
particular, those operations involving complex expressions with large
<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>/<code class="xref py py-class docutils literal notranslate"><span class="pre">Series</span></code> objects should see a
significant performance benefit.  Here is a plot showing the running time of
<code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> as function of the size of the frame involved in the
computation. The two lines are two different engines.</p>
<img alt="_images/eval-perf.png" src="_images/eval-perf.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Operations with smallish objects (around 15k-20k rows) are faster using
plain Python:</p>
<blockquote class="last">
<div><img alt="_images/eval-perf-small.png" src="_images/eval-perf-small.png" />
</div></blockquote>
</div>
<p>This plot was created using a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> with 3 columns each containing
floating point values generated using <code class="docutils literal notranslate"><span class="pre">numpy.random.randn()</span></code>.</p>
</div>
<div class="section" id="technical-minutia-regarding-expression-evaluation">
<h3>Technical Minutia Regarding Expression Evaluation<a class="headerlink" href="#technical-minutia-regarding-expression-evaluation" title="Permalink to this headline">¶</a></h3>
<p>Expressions that would result in an object dtype or involve datetime operations
(because of <code class="docutils literal notranslate"><span class="pre">NaT</span></code>) must be evaluated in Python space. The main reason for
this behavior is to maintain backwards compatibility with versions of NumPy &lt;
1.7. In those versions of NumPy a call to <code class="docutils literal notranslate"><span class="pre">ndarray.astype(str)</span></code> will
truncate any strings that are more than 60 characters in length. Second, we
can’t pass <code class="docutils literal notranslate"><span class="pre">object</span></code> arrays to <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> thus string comparisons must be
evaluated in Python space.</p>
<p>The upshot is that this <em>only</em> applies to object-dtype expressions. So, if
you have an expression–for example</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [64]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;strings&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;cba&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">   ....: </span>                   <span class="s1">&#39;nums&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">)})</span>
<span class="gp">   ....: </span>

<span class="gp">In [65]: </span><span class="n">df</span>
<span class="gh">Out[65]: </span><span class="go"></span>
<span class="go">  strings  nums</span>
<span class="go">0       c     0</span>
<span class="go">1       c     0</span>
<span class="go">2       c     0</span>
<span class="go">3       b     1</span>
<span class="go">4       b     1</span>
<span class="go">5       b     1</span>
<span class="go">6       a     2</span>
<span class="go">7       a     2</span>
<span class="go">8       a     2</span>

<span class="gp">In [66]: </span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;strings == &quot;a&quot; and nums == 1&#39;</span><span class="p">)</span>
<span class="go">                                                                                                                                                                          Out[66]: </span>
<span class="go">Empty DataFrame</span>
<span class="go">Columns: [strings, nums]</span>
<span class="go">Index: []</span>
</pre></div>
</div>
<p>the numeric part of the comparison (<code class="docutils literal notranslate"><span class="pre">nums</span> <span class="pre">==</span> <span class="pre">1</span></code>) will be evaluated by
<code class="docutils literal notranslate"><span class="pre">numexpr</span></code>.</p>
<p>In general, <code class="xref py py-meth docutils literal notranslate"><span class="pre">DataFrame.query()</span></code>/<code class="xref py py-func docutils literal notranslate"><span class="pre">pandas.eval()</span></code> will
evaluate the subexpressions that <em>can</em> be evaluated by <code class="docutils literal notranslate"><span class="pre">numexpr</span></code> and those
that must be evaluated in Python space transparently to the user. This is done
by inferring the result type of an expression from its arguments and operators.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/enhancingperf.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2008-2014, the pandas development team.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>