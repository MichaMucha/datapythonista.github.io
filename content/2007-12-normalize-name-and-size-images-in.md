Title: Normalize name and size images in Django (and adding thumbnails)
Author: Marc
Date: 2007-12-10 01:19:00
Slug: normalize-name-and-size-images-in
Tags: Applications,Django,IT

I wanted to assign an image to every element in a model. I wanted them to have a thumbnail, and to have normalized sizes and names. And of course, I want my application to do everything automatically.<br/><br/>The best method I've found is next, modifying models.py (note that PIL must be installed):<br/><code style="text-align: left"><br/>def rename_image(src, field, id):<br/>&nbsp;&nbsp;&nbsp;&nbsp;file_ext = os.path.splitext(src)[1].lower().replace('jpg', 'jpeg')<br/>&nbsp;&nbsp;&nbsp;&nbsp;dst = 'img/uploaded/work_%s/%s_%s%s' % (field, field, id, file_ext)<br/>&nbsp;&nbsp;&nbsp;&nbsp;return dst<br/></code><br/><br/><code style="text-align: left"><br/>def resize_image(src, dst, size):<br/>&nbsp;&nbsp;&nbsp;&nbsp;from PIL import Image<br/>&nbsp;&nbsp;&nbsp;&nbsp;image = Image.open(src)<br/>&nbsp;&nbsp;&nbsp;&nbsp;image.thumbnail(size, Image.ANTIALIAS)<br/>&nbsp;&nbsp;&nbsp;&nbsp;image.save('%s%s' % (settings.MEDIA_ROOT, dst))<br/>&nbsp;&nbsp;&nbsp;&nbsp;return dst<br/></code><br/><br/><code style="text-align: left"><br/>class MyModel(models.Model):<br/>&nbsp;&nbsp;&nbsp;&nbsp;image = models.ImageField(upload_to='img/uploaded/work_image', verbose_name=_('imagen'))<br/>&nbsp;&nbsp;&nbsp;&nbsp;thumbnail = models.ImageField(editable=False, upload_to='img/uploaded/work_thumbnail')<br/>&nbsp;&nbsp;&nbsp;&nbsp;[...]<br/></code><br/><br/><code style="text-align: left"><br/>&nbsp;&nbsp;&nbsp;&nbsp;def save(self):<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(MyModel, self).save()<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if self.image != rename_image(self.image, 'image', self.id):<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original_filename = self.get_image_filename()<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.thumbnail = resize_image(original_filename, rename_image(original_filename, 'thumbnail', self.id), [100, 75])<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.image = resize_image(original_filename, rename_image(original_filename, 'image', self.id), [640, 480])<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if os.path.exists(original_filename):<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.remove(original_filename)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(MyModel, self).save()<br/></code>